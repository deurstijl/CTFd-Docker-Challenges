{% extends 'admin/base.html' %}
{% block content %}
<div class="jumbotron">
    <div class="container">
        <h1>Docker Config</h1>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-md-6 offset-md-3">
            {% for error in errors %}
            <div class="alert alert-danger alert-dismissable" role="alert">
                <span class="sr-only">Error:</span>
                {{ error }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
            </div>
            {% endfor %}
            <form method="post" accept-charset="utf-8" autocomplete="off" role="form" name="docker_config" class="form-horizontal" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="hostname-input">Hostname</label>
                    <input class="form-control" type="text" name="hostname" id="hostname-input" placeholder="Ex: 10.10.10.10:2376" value="{{ config.hostname or '' }}"/>
                </div>

                <div class="form-group">
                    <p>TLS Enabled?</p>
                    <input type="radio" name="tls_enabled" id="tls-radiobox-no" value="False" {% if not config.tls_enabled %}checked{% endif %} />
                    <label for="tls-radiobox-no">No</label>
                    <input type="radio" name="tls_enabled" id="tls-radiobox-yes" value="True" {% if config.tls_enabled %}checked{% endif %} />
                    <label for="tls-radiobox-yes">Yes</label>
                </div>

                <div class="form-group">
                    <label for="ca_file">
                        CA Cert {% if config.ca_cert %} (Uploaded. Adding a new file will overwrite.) {% endif %}
                    </label>
                    <input class="form-control" type="file" name="ca_cert" id="ca_file" {% if not config.tls_enabled %} disabled {% endif %} {% if config.tls_enabled and not config.ca_cert %} required {% endif %} />
                </div>
                <div class="form-group">
                    <label for="client_file">
                        Client Cert {% if config.client_cert %} (Uploaded. Adding a new file will overwrite.) {% endif %}
                    </label>
                    <input class="form-control" type="file" name="client_cert" id="client_file" {% if not config.tls_enabled %} disabled {% endif %} {% if config.tls_enabled and not config.client_cert %} required {% endif %} />
                </div>
                <div class="form-group">
                    <label for="key_file">
                        Client Key {% if config.client_key %} (Uploaded. Adding a new file will overwrite.) {% endif %}
                    </label>
                    <input class="form-control" type="file" name="client_key" id="key_file" {% if not config.tls_enabled %} disabled {% endif %} {% if config.tls_enabled and not config.client_key %} required {% endif %} />
                </div>
                <div class="form-group">
                    <label for="repositories">Repositories</label>
                    <select id="repositories" name="repositories" class="form-control" size="10" multiple>
                      {% if form.repositories.choices[0][0] == "ERROR" %}
                        <option value="False" disabled>{{ form.repositories.choices[0][1] }}</option>
                      {% elif form.repositories %}
                        {% for key, value in form.repositories.choices|sort(attribute=1, case_sensitive=False) %}
                          <option value="{{ key }}" {% if key in repos %}selected{% endif %}>{{ value }}</option>
                        {% endfor %}
                      {% else %}
                        <option value="False" disabled>Connect Docker API First</option>
                      {% endif %}
                    </select>
                </div>
                {{ form.nonce() }}
                <div class="col-md-13 text-center">
                    <button type="submit" class="btn btn-md btn-primary btn-outlined">
                        Submit
                    </button>
                </div>
                <input type="hidden" name="id" value="1">
            </form>
        </div>
    </div>
</div>
{% endblock content %}

{% block scripts %}
<script {% if csp_nonce %} nonce="{{ csp_nonce }}" {% endif %}>
document.addEventListener('DOMContentLoaded', function () {
    function enable_file_form(enable) {
        const ca = document.getElementById('ca_file');
        const client = document.getElementById('client_file');
        const key = document.getElementById('key_file');

        ca.disabled = !enable;
        client.disabled = !enable;
        key.disabled = !enable;

        ca.required = enable;
        client.required = enable;
        key.required = enable;
    }

    const tlsYes = document.getElementById('tls-radiobox-yes');
    const tlsNo = document.getElementById('tls-radiobox-no');

    if (tlsYes && tlsNo) {
        tlsYes.addEventListener('change', function () {
            if (this.checked) {
                enable_file_form(true);
            }
        });

        tlsNo.addEventListener('change', function () {
            if (this.checked) {
                enable_file_form(false);
            }
        });
    }
});
</script>
{% endblock scripts %}
